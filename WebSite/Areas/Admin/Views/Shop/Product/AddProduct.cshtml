@using ZoomLa.Common
@using ZoomLa.BLL.Content
@using ZoomLa.Model
@using System.Data
@using ZoomLaCMS.Models.Field
@using ZoomLaCMS.Control
@model ZoomLaCMS.Models.Product.VM_Product
@{
    string action = Model.proMod.ID < 1 ? "添加" : "修改";
    if (string.IsNullOrEmpty(Model.regionMod.Info)){ Model.regionMod.Info = "[]"; }
}
@section head{
<style type="text/css">
.fd_td_l { width: 120px; }
.proclass_tab { display: none; }
#Proname { background: url(/Images/bg1.gif) repeat-x; }
#cbind_btn { display: none; }
.upload_wrap img{width:100px;height:100px;display:block;margin-bottom:5px;}
.upload_wrap iframe{top: 2px; width: 100%; height: 30px;}
</style>
<script charset="utf-8" src="/Plugins/Ueditor/ueditor.config.js"></script>
<script charset="utf-8" src="/Plugins/Ueditor/ueditor.all.js"></script>
<script src="/JS/Plugs/angular.min.js"></script>
<link type="text/css" href="/dist/css/bootstrap-switch.min.css" rel="stylesheet" />
<title>@(action)商品</title>
}
        @section content{
<div class="container-fluid pr-0">
<div class="row sysRow  w-100">
<div class="container-fluid mysite" id="BreadDiv">
    <div class="row">
        <ol id="BreadNav" class="breadcrumb fixed-top w-100">
            <li class="breadcrumb-item"><a href='@(CustomerPageAction.customPath2)Main'>工作台</a></li>
            <li class="breadcrumb-item"><a href='@(CustomerPageAction.customPath2)Product/ProductManage'>商品列表</a></li>
            <li class="breadcrumb-item"><a href='@(CustomerPageAction.customPath2)Product/ProductManage?NodeID=@Model.NodeID'>@Model.nodeMod.NodeName</a></li>
            <li class="breadcrumb-item">
                @(action)商品
                @if (!string.IsNullOrEmpty(Model.proMod.ModeTemplate))
        {
                    <span class="text-danger">(该商品已启用个性模板)</span>
                }
            </li>
            <div class='float-right hidden-xs ml-auto'><span onclick="opentitle('@Model.NodeID','配置本节点');" class='zi zi_cog' title='配置本节点' style='cursor:pointer;margin-left:5px;'></span></div>
        </ol>
    </div>
</div>
<form method="post" id="form1" class="w-100" ng-app="app">
    <ul class="nav nav-tabs list_choice">
        <li class="nav-item"><a class="nav-link active" href="#Tabs0" data-toggle="tab">基本信息</a></li>
        <li class="nav-item"><a class="nav-link" href="#Tabs1" data-toggle="tab">商品说明</a></li>
        <li class="nav-item"><a class="nav-link" href="#Tabs2" data-toggle="tab">库存厂税</a></li>
        <li class="nav-item"><a class="nav-link" href="#Tabs3" data-toggle="tab">价格运费</a></li>
        <li class="nav-item"><a class="nav-link" href="#Tabs4" data-toggle="tab">促销推广</a></li>
        <li class="nav-item"><a class="nav-link" href="#Tabs5" data-toggle="tab">详细属性</a></li>
    </ul>
    <div class="tab-content panel-body p-0">
        <div id="Tabs0" class="tab-pane active manage_content">
            <table class="table table-striped table-bordered sys_table w-100">
                <tbody>
                    <tr>
                        <th class="w12rem_lg">所属节点</th>
                        <td>
                            @Model.nodeMod.NodeName
                            <input type="hidden" id="Group_Hid" name="Group_Hid" value="@Model.groupList" />
                        </td>
                    </tr>
                    <tr>
                        <th>所属店铺</th>
                        <td>
                            @Html.DropDownList("UserShopID", Model.GetStoreList(Model.proMod.UserShopID.ToString()), new { @class = "form-control max20rem" })
                        </td>
                    </tr>
                    <tr>
                        <th>商品编号</th>
                        <td>
                            <div class="input-group">
                                <input type="text" id="ProCode" name="ProCode" class="form-control max20rem" value="@Model.proMod.ProCode" />
                                <span class="input-group-append">
                                    <label class="btn btn-light"><input type="checkbox" value="1" name="verbak_chk" /> 存档备份</label>
                                    @*<button type="button" class="btn btn-info btn-sm" @(Model.proMod.ID < 1 ? "disabled=\"disabled\"" : "") onclick="verbak.showDiag();"><i class="zi zi_database"></i> 版本浏览</button>*@
                                </span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>商品名称</th>
                        <td>
                            <div class="input-group ">
                                <input type="text" id="Proname" name="Proname" class="form-control m50rem_50 required" onkeydown="isgoEmpty('Proname','span_Proname');" title="商品名称不能为空" value="@Model.proMod.Proname" />
                            </div>
                            <div>
                                <span id="span_Proname"></span>
                                <span><span class="vaild_tip"></span></span>
                            </div>
                            <label for="Proname" class="error"></label>
                        </td>
                    </tr>
                    <tr>
                        <th>短名称</th>
                        <td>
                            <input type="text" id="ShortProName" name="ShortProName" class="form-control max20rem" maxlength="5" value="@Model.proMod.ShortProName" />
							<small class="text-muted">(5个字符以内(如:滋养型,无硅油),为空则会自动截取商品名称前5个字符)</small>
                        </td>
                    </tr>
                    <tr>
                        <th>商品类型</th>
                        <td>
                            @MVCHelper.H_Radios("proclass_rad", "正常商品|虚拟商品|特价|积分|团购|IDC|旅游|酒店".Split('|'), "1,5,2,3,4,6,7,8".Split(','), Model.proMod.ProClass.ToString(), "onclick=\"proclass.switch (this.value);\"")
                            <div class="proclass_tab" id="proclass_tab6">
                                <table class="table table-bordered table-striped" style="width:400px;">
                                    <tr><td class="td_m">期限</td><td class="td_m">价格</td><td class="td_xs"><a href="javascript:;" class="btn btn-primary" onclick="idc.addrow();"><i class="zi zi_plus"></i></a></td></tr>
                                    <tbody id="idc_list">
                                        <tr><td><input type="text" class="form-control time" value="7天" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="15天" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="1月" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="季度" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="半年" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="1年" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="2年" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="无限期" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="zi zi_minus"></i></a></td></tr>
                                    </tbody>
                                </table>
                                <input type="hidden" id="IDC_Hid" name="IDC_Hid" value="@Model.proMod.IDCPrice" />
                                <div class="alert alert-info">价格或期限为空则不显示,支持(天|月|年|季度|无限期)</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>所属专题</th>
                        <td>
                            @Html.Partial("/Areas/Admin/Views/Content/Addon/Special.cshtml", new C_Model() { value = Model.proMod.SpecialID,addon="1" })
                        </td>
                    </tr>
                    <tr>
                        <th>关键字</th>
                        <td>
                            <div id="OAkeyword" class="max20rem"></div>
                            <input type="text" id="Keywords" name="Keywords" style="display:none;" value="@Model.proMod.Kayword" />
                            <input type="hidden" id="IgnoreKey_Hid" name="IgnoreKey_Hid" />
							<small class="text-muted">((空格或回车键分隔，长度不超过10字符或5汉字)</small>
                        </td>
                    </tr>
                   
                    <tr>
                        <th>商品单位</th>
                        <td>
							<div class="input-group">
								<input type="text" id="ProUnit" name="ProUnit" class="form-control max20rem required" title="商品单位不能为空" value="@Model.proMod.ProUnit" />
								<div id="Unitd" class="input-group-append">
									<button type="button" class="btn btn-outline-info">件</button>
									<button type="button" class="btn btn-outline-info">个</button>
									<button type="button" class="btn btn-outline-info">只</button>
									<button type="button" class="btn btn-outline-info">组</button>
									<button type="button" class="btn btn-outline-info">套</button>
									<button type="button" class="btn btn-outline-info">把</button>
									<button type="button" class="btn btn-outline-info">双</button>
									<button type="button" class="btn btn-outline-info">台</button>
									<button type="button" class="btn btn-outline-info">年</button>
									<button type="button" class="btn btn-outline-info">月</button>
									<button type="button" class="btn btn-outline-info">日</button>
									<button type="button" class="btn btn-outline-info">季</button>
								</div>
							</div>
                        </td>
                    </tr>
                    <tr>
                        <th>商品重量</th>
                        <td>
							<div class="input-group">
							  <input type="text" id="Weight_T" name="Weight_T" class="form-control max20rem num_float" title="商品重量必须是数字" value="@Model.proMod.Weight" />
							  <div class="input-group-append">
								<span class="input-group-text" id="basic-addon2">千克</span>
							  </div>
							</div>
                            <label for="Weight_T" class="error"></label>
                        </td>
                    </tr>
                    <tr>
                        <th>条形码</th>
                        <td>
                            <input type="text" id="BarCode" name="BarCode" class="form-control max20rem num nofocus" value="@Model.proMod.BarCode" />
                        </td>
                    </tr>
                    <tr>
                        <th>销售状态</th>
                        <td>
                            <label><input type="checkbox" id="Sales_Chk" name="Sales_Chk" value="1" @(Model.proMod.Sales == 1 ? "checked='checked'" : "") />打勾表示销售中，否则为停售状态</label>
                        </td>
                    </tr>
                    <tr>
                        <th>属性设置</th>
                        <td>
                            <label><input type="checkbox" id="istrue_chk" name="istrue_chk" value="1" @(Model.proMod.Istrue == 1 ? "checked='checked'" : "") />审核通过</label>
                            <label><input type="checkbox" id="isnew_chk" name="isnew_chk" value="1" @(Model.proMod.Isnew == 1 ? "checked='checked'" : "") />新品</label>
                            <label><input type="checkbox" id="ishot_chk" name="ishot_chk" value="1" @(Model.proMod.Ishot == 1 ? "checked='checked'" : "") />热销</label>
                            <label><input type="checkbox" id="isbest_chk" name="isbest_chk" value="1" @(Model.proMod.Isbest == 1 ? "checked='checked'" : "") />精品</label>
                        </td>
                    </tr>
                    <tr>
                        <th>售后设置</th>
                        <td>
                            <label><input type="checkbox" name="GuessXML" value="drawback" checked="checked" />退货</label>
                            <label><input type="checkbox" name="GuessXML" value="exchange" />换货</label>
                            <label><input type="checkbox" name="GuessXML" value="repair" />维修</label>
                            <input type="hidden" id="restate_hid" value="@Model.proMod.GuessXML" />
                        </td>
                    </tr>
                    <tr>
                        <th>会员特选</th>
                        <td>
                            <label><input type="checkbox" id="Largess" name="Largess" class="switchChk" value="1" @(Model.proMod.Largess == 1 ? "checked='checked'" : "") /></label>
                            <small class="text-muted">(设置为特选商品后,只有指定会员才可购买)</small>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs1" class="tab-pane">
            <table class="table table-striped table-bordered sys_table w-100">
                <tbody>
                    <tr>
                        <th class="w12rem_lg">商品简介</th>
                        <td>
                            <textarea id="Proinfo" name="Proinfo" class="form-control m50rem_50"  placeholder="用于首页及栏目页显示，最多255个字符">@Model.proMod.Proinfo</textarea>
                        </td>
                    </tr>
                    <tr>
                        <th>详细介绍</th>
                        <td>
                            <textarea id="Procontent" name="Procontent" style="width: 1024px; height: 300px;">@Model.proMod.Procontent</textarea>
                            @MvcHtmlString.Create(Call.GetUEditor("Procontent", 3))
                        </td>
                    </tr>
                    <tr>
                        <th>商品清晰图</th>
                        <td>
                             @Html.Partial("C_SFileUP", new C_SFileUP { FileType = "img", SaveType = "admin", ID = "Clearimg", Value=function.GetImgUrl(Model.proMod.Clearimg),AutoUpload=true })
                            @*<div class="upload_wrap">
                                <img id="Img_Clearimg" src="@function.GetImgUrl(Model.proMod.Clearimg)" />
                                <input type="text" id="txt_Clearimg" name="txt_Clearimg" value="@Model.proMod.Clearimg" class="form-control max20rem" />
                                <iframe src="/Common/fileupload?FieldName=Clearimg&ModelID=@Model.ModelID&NodeID=@Model.NodeID" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe>
                            </div>*@
                        </td>
                    </tr>
                    <tr id="addsmallimg">
                        <th>商品缩略图</th>
                        <td>
                            @Html.Partial("C_SFileUP", new C_SFileUP { FileType = "img", SaveType = "admin", ID = "Thumbnails",Value=function.GetImgUrl(Model.proMod.Thumbnails),AutoUpload=true })
                            @*<div class="upload_wrap">
                               <img id="Img_Thumbnails" src="@function.GetImgUrl(Model.proMod.Thumbnails)" />
                                <input type="text" id="txt_Thumbnails" name="txt_Thumbnails" value="@Model.proMod.Thumbnails" class="form-control max20rem" />
                                <iframe src="/Common/fileupload?FieldName=Thumbnails&ModelID=@Model.ModelID&NodeID=@Model.NodeID" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe>
                            </div>*@
                        </td>
                    </tr>
                    <tr>
                        <th>个性模板</th>
                        <td>
                            @MvcHtmlString.Create(PageCommon.GetTlpDP("ModeTemplate"))
                            <input type="hidden" id="ModeTemplate_hid" name="ModeTemplate_hid" value="@Model.proMod.ModeTemplate" />
                        </td>
                    </tr>
                    <tr>
                        <th>点击数</th>
                        <td>
                            <input type="text" id="AllClickNum" name="AllClickNum" value="@Model.proMod.AllClickNum" class="form-control max20rem" />
                        </td>
                    </tr>
                    <tr>
                        <th>发布时间</th>
                        <td>
                            <input type="text" id="AddTime" name="AddTime" value="@Model.proMod.AddTime" class="form-control max20rem" onclick="WdatePicker({ dateFmt: 'yyyy/MM/dd HH:mm' });" />
                        </td>
                    </tr>
                    <tr>
                        <th>更新时间</th>
                        <td>
                            <input type="text" id="UpdateTime" name="UpdateTime" value="@Model.proMod.UpdateTime" class="form-control max20rem" onclick="WdatePicker({ dateFmt: 'yyyy/MM/dd HH:mm' });" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs2" class="tab-pane table-responsive">
            <table class="table table-striped table-bordered sys_table w-100">
                <tbody>
                    @*<tr>
                        <th class="w12rem_lg">生 产 商</th>
                        <td>
							<div class="input-group">
							  <input type="text" id="ProducerName" class="form-control max20rem" value=""/>
							  <div class="input-group-append">
								<input type="button" value="选择" class="input-group-text" onclick="producer.sel()" />
							  </div>
							</div>
							<input type="hidden" id="Producer" name="Producer" value="" />
                        </td>
                    </tr>
                    <tr>
                        <th>品牌/商标</th>
                        <td>
							<div class="input-group">
							  <input type="text" id="BrandName" class="form-control max20rem" value=""/>
							  <div class="input-group-append">
								<input type="button" value="选择" class="input-group-text" onclick="brand.sel();" />
							  </div>
							</div>
							<input type="hidden" id="Brand" name="Brand" class="form-control max20rem" value="" />
                        </td>
                    </tr>*@
                    <tr>
                        <th>缺货时允许购买</th>
                        <td>
                            <label><input type="checkbox" id="Allowed" name="Allowed" value="1" @(Model.proMod.Allowed == 1 ? "checked='checked'" : "") />打勾表示缺货时允许购买， 否则缺货时不允许购买</label>
                        </td>
                    </tr>
                    <tr>
                        <th>限购数量</th>
                        <td>
                            <label><input type="radio" name="Quota_Rad" value="0" onclick="$('#Quota_EGV').hide();" checked="checked" />不设置</label>
                            <label><input type="radio" name="Quota_Rad" value="2" onclick="$('#Quota_EGV').show();" />按会员组</label>
                            <table class="table table-bordered table-striped text_405" id="Quota_EGV" style="display:none;">
                                <tr><td class="td_l">会员组</td><td>数量(0为禁止,-1不限)</td></tr>
                                @foreach (DataRow dr in Model.gpriceDT.Rows)
                                {
                                    <tr><td><label>@dr["GroupName"]</label></td><td><input type="text" class="form-control Quota_Group_T" data-gid="@dr["GroupID"]" value="@ZoomLa.Common.DataConverter.CLng(dr["quota"],-1)" /></td></tr>
                                }
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th>最低购买数量</th>
                        <td>
                            <label><input type="radio" name="DownQuota_Rad" value="0" onclick="$('#DownQuota_EGV').hide();" checked="checked" />不设置</label>
                            <label><input type="radio" name="DownQuota_Rad" value="2" onclick="$('#DownQuota_EGV').show();" />按会员组</label>
                            <table class="table table-bordered table-striped text_405" id="DownQuota_EGV" style="display:none;">
                                <tr><td class="td_l">会员组</td><td>数量</td></tr>
                                @foreach (DataRow dr in Model.gpriceDT.Rows)
                                {
                                    <tr><td><label>@dr["GroupName"]</label></td><td><input type="text" class="form-control DownQuota_Group_T" data-gid="@dr["GroupID"]" value="@ZoomLa.Common.DataConverter.CLng(dr["downquota"],1)" /></td></tr>
                                }
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <th>数量模式</th>
                        <td>
                            <input type="text" id="DownCar" name="DownCar" class="form-control max20rem digits" value="@Model.proMod.DownCar"  />
							<small class="text-muted">购买时必须为该数值的倍数</small>
                        </td>
                    </tr>
                    <tr>
                        <th>库存数量</th>
                        <td>
						<div class="input-group">
							  <input type="text" id="Stock" name="Stock" class="form-control max20rem" value="@Model.proMod.Stock" readonly="readonly" style="margin-right:5px;"/>

							   @if (Model.proMod.ID > 0){ <a href="javascript:;" class="btn btn-info" onclick="ShowComDiag('@Call.PA("Product/StockAdd?ProID="+Model.proMod.ID)','管理库存');">管理库存</a> }

							</div>
                        </td>
                    </tr>
                    <tr>
                        <th>库存报警下限</th>
                        <td>
                            <input type="text" id="StockDown" name="StockDown" value="@Model.proMod.StockDown" class="form-control digits max20rem" title="库存报警下限必须是数字!" />
                        </td>
                    </tr>
                    <tr>
                        <th>前台库存计算方式</th>
                        <td>
                            <label><input type="radio" name="JisuanFs" value="0" checked="checked" />实际库存</label>
                            <label><input type="radio" name="JisuanFs" value="1" />虚拟库存</label>
                        </td>
                    </tr>
                    <tr>
                        <th>税率设置</th>
                        <td>
                            @MVCHelper.H_Radios("Rateset", "含税，不开发票时有税率优惠,含税，不开发票时没有税率优惠,不含税，开发票时需要加收税费,不含税，开发票时不需要加收税费".Split(','), "1,2,3,4,5".Split(','), Model.proMod.Rateset.ToString())
                    </td>
                </tr>
                <tr>
                    <th>商品税率</th>
                    <td>
						<div class="input-group">
						  <input type="text" id="Rate" name="Rate" class="form-control max20rem number" title="商品税率必须是数字!" value="@Model.proMod.Rate.ToString("F0")" />
						  <div class="input-group-append">
							<span class="input-group-text" id="basic-addon2">%</span>
						  </div>
						</div>
                    </td>
                </tr>
                <tr>
                    <th>商品推荐等级</th>
                    <td>
                        @MVCHelper.H_Radios("Dengji", "★★★★★,★★★★,★★★,★★,★".Split(','), "5,4,3,2,1".Split(','), Model.proMod.Dengji.ToString())
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
        <div id="Tabs3" class="tab-pane table-responsive">
            <table class="table table-striped table-bordered sys_table w-100">
                <tbody>
                    <tr>
                        <th class="w12rem_lg">市场价格 <span class="text-danger">*</span></th>
                        <td>
							<div class="input-group">
							  <input type="text" id="ShiPrice" name="ShiPrice" class="form-control w12rem_lg linprice max20rem" value="@Model.proMod.ShiPrice" autocomplete="off"/>
							  <div class="input-group-append">
								<span class="input-group-text" id="basic-addon2">元</span>
							  </div>
							</div>
							
                            <label for="ShiPrice" class="error"></label>
                        </td>
                    </tr>
                    <tr>
                        <th>零售价 <span class="text-danger">*</span></th>
                        <td>
							<div class="input-group">
							  <input type="text" id="LinPrice" name="LinPrice" class="form-control w12rem_lg linprice max20rem" value="@Model.proMod.LinPrice" autocomplete="off"/>
							  <div class="input-group-append">
								<span class="input-group-text" id="basic-addon2">元</span>
							  </div>
							</div>
                            <label for="LinPrice" class="error"></label>
                        </td>
                    </tr>
                    <tr>
                        <th>预订价格</th>
                        <td>
							<div class="input-group">
							  <input type="text" id="BookPrice" name="BookPrice" class="form-control max20rem" value="@Model.proMod.BookPrice" />
							  <div class="input-group-append">
								<span class="input-group-text" id="basic-addon2">元</span>
							  </div>
							</div>
							<small class="text-muted">如设定了预订价,则购买时只需支付预定金额</small>
                        </td>
                    </tr>
                    @*<tr>
                        <th>折扣优惠</th>
                        <td>
                            <div class="input-group w12rem_lg">
                                <input type="text" id="Recommend" name="Recommend" class="form-control w12rem_lg number" value="@Model.proMod.Recommend" /><span class="input-group-addon">%</span>
                            </div>
                        </td>
                    </tr>*@
                    @*<tr>
                        <th>附加售价</th>
                        <td>
                            <div id="linprice_td">
                                <div class="input-group text_405">
                                    <span class="input-group-addon">余额</span><input type="text" id="LinPrice_Purse_T" name="LinPrice_Purse_T" class="form-control w12rem_lg curprice number" title="余额只能为数字" />
                                    <span class="input-group-addon">银币</span><input type="text" id="LinPrice_Sicon_T" name="LinPrice_Sicon_T" class="form-control w12rem_lg curprice number" title="银币只能为数字" />
                                    <span class="input-group-addon">积分</span><input type="text" id="LinPrice_Point_T" name="LinPrice_Point_T" class="form-control w12rem_lg curprice number" title="积分只能为数字" />
                                </div>
                            </div>
                        </td>
                    </tr>*@
                    <tr>
                        <th>多价格</th>
                        <td>
                            <table class="table table-bordered table-striped table-hover w-100">
                                <tbody id="child_tb">
                                    <tr class="childtr">
                                        <td>



                                            <input type="hidden" name="C_code_hid" value="@MvcHtmlString.Create("@code")" />
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">品名：</span>
                                                </div>
                                                <input type="text" name="C_Proname_T" class="form-control max20rem" value="@MvcHtmlString.Create("@Proname")" />
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">价格：</span>
                                                </div>
                                                <input type="text" name="C_LinPrice_T" class="form-control max20rem" value="@MvcHtmlString.Create("@LinPrice")" />
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">零售价：</span>
                                                </div>
                                                <input type="text" name="C_ShiPrice_T" class="form-control max20rem" value="@MvcHtmlString.Create("@ShiPrice")" />
                                                <div class="input-group-append">
                                                    <a href="javascript:;" class="btn btn-outline-info addchild"><i class="zi zi_plus"></i></a>
                                                    <a href="javascript:;" class="btn btn-outline-info delchild"><i class="zi zi_minus"></i></a>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <input type="hidden" id="ChildPro_Hid" name="ChildPro_Hid" value="@Model.proMod.Wholesalesinfo" />
                        </td>
                    </tr>
                    
                    <tr>
                        <th>区域价格</th>
                        <td>
                            <div class="input-group mb-2 text_405">
                                <input type="text" id="region_skey_t" placeholder="请输入地区名称" class="form-control max20rem" />
                                <span class="input-group-append">
                                    <a href="javascript:;" onclick="region.search();" class="btn btn-info"><i class="zi zi_search"></i></a>
                                    <button class="btn btn-outline-info" type="button" onclick="region.add()">设置多区域价格</button>
                                </span>
                            </div>
                            <div style="width:600px;max-height:300px;overflow-y:auto;">
                                <table class="table table-bordered table-striped margin_t5">
                                    <tr><td>区域名称</td><td>会员组|价格</td><td>操作</td></tr>
                                    <tbody id="region_div"></tbody>
                                </table>
                            </div>
                            <input type="hidden" name="ProGuid" value="@Model.proMod.ProCode" />
                        </td>
                    </tr>
                    <tr>
                        <th>会员价</th>
                        <td>
                            <label><input type="radio" value="0" name="UserPrice_Rad" onclick="$('.user_price_div').hide();" checked="checked" />不设置</label>
                            <label><input type="radio" value="1" name="UserPrice_Rad" onclick="$('.user_price_div').hide(); $('#price_member_div').show();" />会员价</label>
                            <label><input type="radio" value="2" name="UserPrice_Rad" onclick="$('.user_price_div').hide(); $('#price_group_div').show();" />按会员组</label>
                            <span class="rd_green">为0则按原价计算</span>
                            <div id="price_member_div" style="@(Model.proMod.UserType != 1 ? "display: none;" : "")" class="input-group max20rem user_price_div">
                                <span class="input-group-addon">会员价</span>
                                <input type="text" id="UserPrice" name="UserPrice" class="form-control" value="@Model.proMod.UserPrice" />
                                <span class="input-group-addon">元</span>s
                            </div>
                            <div id="price_group_div" style="@(Model.proMod.UserType!=2?"display: none;":"")" class="user_price_div">
                                @foreach (DataRow dr in Model.gpriceDT.Rows)
                            {
                            <div class="input-group max20rem mt-2">
                                <span class="input-group-addon" style="min-width:100px;">@dr["GroupName"]</span>
                                <input type="text" data-gid="@dr["GroupID"]" class="form-control Price_Group_T" value="@dr["price"]" />
                                <span class="input-group-addon">元</span>
                            </div>
                            }
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>运费设置</th>
                        <td>
                            <div>
                                @MVCHelper.H_Radios("FareTlp_Rad", Model.fareDT, "ID", "TlpName", Model.proMod.FarePrice)
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs4" class="tab-pane table-responsive">
            <table class="table table-striped table-bordered sys_table w-100">
                <tbody>
                    <tr>
                        <th class="w12rem_lg">单品组合</th>
                        <td>
                            <div id="grouppro_td" style="max-height:300px;overflow-y:auto;"></div>
                        </td>
                    </tr>
                    <tr>
                        <th>赠送商品</th>
                        <td>
                            @Html.Partial(MVCHelper.ViewDir_Admin_Product+"Addon/Present.cshtml",Model)
                        </td>
                    </tr>
                    <tr>
                        <th>赠送积分</th>
                        <td>
                            <input type="text" id="PointVal" name="PointVal" class="form-control w12rem_lg number" title="积分值必须是数字" value="@Model.proMod.PointVal" />
                        </td>
                    </tr>
                    <tr>
                        <th>捆绑销售</th>
                        <td>
                            @Html.Partial("Comp/SelProduct", new C_SelProduct(){value=Model.proMod.BindIDS })
                        </td>
                    </tr>
                </tbody>
            </table>
            
        </div>
        <div id="Tabs5" class="tab-pane">
            <table class="table table-striped table-bordered">
                @Html.Partial("Fields/Index_Admin_AddContent", new VM_FieldModel(Model.ModelID, Model.NodeID, new ModelConfig() { Source = ModelConfig.SType.Admin }, 0, Model.ValueDR))
            </table>
        </div>
</div>

<div class="text-center Conent_fix">
    <input type="button" class="btn btn-outline-info submit-loading" onclick="subData('@(MVCHelper.GetAction("Product_Add",Context.Request))');" value="保存商品信息" />
    @if (Model.proMod.ID > 0)
    {
        <input type="button" class="btn btn-outline-info submit-loading" onclick="subData('@(MVCHelper.GetAction("Product_AddToNew",Context.Request))');" value="添加为新商品" />
    }
    <a href="@(CustomerPageAction.customPath2+"Shop/")ProductManage?@("NodeID="+Model.NodeID+" &StoreID="+Model.proMod.UserShopID)" class="btn btn-outline-info">返回列表<i class="zi zi_circleUpLong"></i></a>
</div>
<input type="hidden" id="Price_Group_Hid" name="Price_Group_Hid" />
<input type="hidden" id="Quota_Group_Hid" name="Quota_Group_Hid" />
<input type="hidden" id="DownQuota_Group_Hid" name="DownQuota_Group_Hid" />
</form>
</div>
</div>
@Html.Partial("C_TlpDP", new C_TlpDP("TemplateIndex", ""))
}
@section script{
<script src="/dist/js/bootstrap-switch.js"></script>
<script src="/JS/OAKeyWord.js"></script>
<script src="/JS/Common.js"></script>
<script src="/JS/DatePicker/WdatePicker.js"></script>
<script src="/JS/Controls/ZL_Array.js"></script>
<script src="/JS/ZL_Content.js"></script>
<script src="/JS/Modal/shop.js?v=5"></script>
<script src="/JS/SelectCheckBox.js"></script>
<script>
    var zlconfig = {
        gid: "@Model.proMod.ID",
        shopPath: "@(CustomerPageAction.customPath2+"shop/")"
    };
    $(function () {
        $.extend($.validator.defaults, { ignore: "" });
        //---------------------------
        MultiPrice.Init();
        ZL_Regex.B_Num(".num");
        $("#Unitd").find("button").click(function () { $("#ProUnit").val($(this).text()); });
        //----商品类型
        if (proclass.$hid.val() == "") { proclass.$hid.val("1"); }
        proclass.$rads.each(function () { if ($(this).val() == proclass.$hid.val()) { $(this).click(); } });
        //idc.init();
        group.init();
        //----模板信息
        Tlp_initTemp();
        //售后设置属性
        var revalues = $("#restate_hid").val().split(',');
        if (revalues.length > 0) {
            $("input[name='GuessXML']").each(function () { this.checked = false; })
            for (var i = 0; i < revalues.length; i++) {
                if (!ZL_Regex.isEmpty(revalues[i])) {
                    var chk = $("input[name=GuessXML][value=" + revalues[i] + "]")[0];
                    if (chk) { chk.checked = true; }
                }
            }
        }
        //---------------赋值
        @*SetRadVal("JisuanFs", "@Model.proMod.JisuanFs");*@
        SetRadVal("UserPrice_Rad", "@Model.proMod.UserType");
        SetRadVal("DownQuota_Rad", "@Model.proMod.DownQuota");
        SetRadVal("Quota_Rad", "@Model.proMod.Quota");
        region.fill(@Html.Raw(Model.regionMod.Info)); 
       
    });
    var diag = new ZL_Dialog();
    function closeDiag() {
        diag.CloseModal();
        CloseComDiag();
    }
    function subData(url) {
        if (!PreSubmit()) {  }
        var valid = $("form").validate({ meta: "validate" });
        if (!valid.form()) { alert("商品名称为空或价格信息不正确"); return false; }
        mvcpage.help.submit({ "url": url });
    }
    function ProductsSelect(act) {
        ShowDiag(zlconfig.shopPath + 'ProductsSelect?act=' + act, '选择商品');
    }
    function ShowDiag(url, title) {
        diag.title = title;
        diag.maxbtn = false;
        diag.width = "width960";
        diag.url = url;
        diag.ShowModal();
    }
    function CloseDiag() {
        diag.CloseModal();
        comdiag.CloseModal();
    }
    function addStock(pronum) {
        CloseDiag();
        var num = parseInt($("#Stock").val());
        $("#Stock").val(pronum + num);
    }
    //-------------------------------------------------------
    //生产商
    var producer = {};
    producer.sel = function () {
        comdiag.width = "width960";
        ShowComDiag(zlconfig.shopPath + "Producerlist", "选择厂商");
    }
    //id|name
    producer.selback = function (json) {
        $("#Producer").val(json.id);
        $("#ProducerName").val(json.name);
        CloseDiag();
    }
    //品牌商标
    var brand = {};
    brand.sel = function () {
        var id = $("#Producer").val();
        if (ZL_Regex.isEmpty(id) || id == 0) { alert("请先选择厂商"); return false; }
        ShowComDiag(zlconfig.shopPath + "Brandlist?id=" + id, "");
    }
    brand.selback = function (json) {
        $("#Brand").val(json.id);
        $("#BrandName").val(json.name);
        CloseDiag();
    }

    //-------------------------------------------------------
    var group = { list: [] }
    group.getName = function (gid) {
        var model = group.list.GetByID(gid, "GroupID");
        console.log(gid, group.list);
        if (!model) { return "未匹配"; }
        else { return model.GroupName; }
    }
    group.init = function () {
        var str = $("#Group_Hid").val();
        if (ZL_Regex.isEmpty(str)) {  }
        group.list = JSON.parse(str);
    }
    //--------------------多区域价格(增加筛选搜索,增加为0不显示)
    var region = { guid: "@(Model.proMod.ProCode)" };
    region.fill = function (list) {
        if (!list || list.length < 1) {  }
        var tlp = '<tr><td>@@region</td><td class="price_td"></td><td>';
        tlp += '<a href="javascript:;" onclick="region.edit(\'@@region\');" class="btn btn-sm btn-info">修改</a>';
        tlp += '<a href="javascript:;" onclick="region.del(this,\'@@region\');" class="btn btn-sm btn-info" style="margin-left:5px;">删除</a>';
        tlp += '</td></tr>';
        var priceTlp = "<div><span>@@gname</span> | <span>@@price</span></div>";
        $div = $("#region_div"); $div.html("");
        $items = JsonHelper.FillItem(tlp, list, function ($item, model) {
            for (var i = 0; i < model.price.length; i++) {
                model.price[i]["gname"] = group.getName(model.price[i].gid);
            }
            var priceItems = JsonHelper.FillItem(priceTlp, model.price);
            $item.find(".price_td").append(priceItems);
        });
        $div.append($items);
    }
    region.add = function () {
        comdiag.reload = true;
        ShowComDiag("@(CustomerPageAction.customPath2)Product/RegionPrice?guid=@(Model.proMod.ProCode)&id=@(Model.proMod.ID)", "多区域价格");
    }
    region.edit = function (region) {
        ShowComDiag("@(CustomerPageAction.customPath2)Product/RegionPriceEdit?guid=" + this.guid + "&id=@(Model.proMod.ID)&region=" + escape(region), "区域价格管理");
    }
    region.del = function (obj, region) {
        $(obj).closest("tr").remove();
        $.post("@(CustomerPageAction.customPath2)Product/RegionPrice?action=del&guid=" + this.guid + "&id=@(Model.proMod.ID)&region=" + escape(region), {}, function (data) {
            var model = APIResult.getModel(data);
            if (!APIResult.isok(model)) { console.log(model.retmsg); }
        });
    }
    region.search = function () {
        var skey = $("#region_skey_t").val();
        if (ZL_Regex.isEmpty(skey)) { $("#region_div tr").show(); }
        else {
            $("#region_div tr").hide();
            $("#region_div tr:contains('" + skey + "')").show();
        }
    }
    UserFunc = null;
	
function opentitle(nid, title) {
if (!nid||nid == 0) alert("尚未选择节点");
else {
///admin/Content/Node/EditNode?NodeID=129
//var url = "../Content/Node/EditNode?NodeID=" + nid;
    var url = "@Call.PathAdmin("Content/Node/NodeAdd?ID=")" + nid;
diag.url = url;
diag.title = title;
diag.ShowModal();
}
}
</script>
}
